<!DOCTYPE html>
<html lang="en">
  <head>
    <title><%= title %></title>
    <link rel="stylesheet" href="css/style.css" />
    <script src="js/categories.js" defer></script>
  </head>
  <body>
    <%- include('partials/header.ejs', {title: title}) %>
    <main class="categories-container">
      <section>
        <div>
          <h3>FreshMart</h3>
          <ul>
            <% categories.freshMart.map(category => { %>
            <li class="list">
              <form action="/items" method="get">
                <input
                  type="hidden"
                  name="categoryId"
                  value="<%= category.id %>"
                />
                <button type="submit" class="category-link">
                  <%= category.category %>
                </button>
              </form>
              <form
                action="/categories/<%= category.id %>/update"
                method="POST"
                class="edit-form"
                style="display: none"
              >
                <input type="hidden" name="_method" value="PATCH" />
                <input
                  type="text"
                  name="newName"
                  value="<%= category.category %>"
                />
                <button type="submit">Save</button>
                <button type="button" class="cancel-edit">Cancel</button>
              </form>
              <button class="edit-button">Edit</button>
              <button class="delete-btn">Delete</button>
              <form
                action="/categories/<%= category.id %>/delete"
                method="post"
                style="display: none"
                class="delete-form"
              >
                <input
                  type="text"
                  name="adminKey"
                  id="adminKey"
                  placeholder="Enter Admin Key"
                  required
                />
                <button type="submit">Confirm</button>
                <button type="button" class="cancel-deletion">Cancel</button>
              </form>
            </li>
            <% }) %>
          </ul>
        </div>
        <div>
          <h3>Organic Heaven</h3>
          <ul>
            <% categories.organicHeaven.map(category => { %>
            <li class="list">
              <form action="/items" method="get">
                <input
                  type="hidden"
                  name="categoryId"
                  value="<%= category.id %>"
                />
                <button type="submit" class="category-link">
                  <%= category.category %>
                </button>
              </form>
              <form
                action="/categories/<%= category.id %>/update"
                method="POST"
                class="edit-form"
                style="display: none"
                id="organicHeavenForm"
              >
                <input type="hidden" name="_method" value="PATCH" />
                <input
                  type="text"
                  name="newName"
                  value="<%= category.category %>"
                />
                <button type="submit">Save</button>
                <button type="button" class="cancel-edit">Cancel</button>
              </form>
              <button class="edit-button">Edit</button>
              <button class="delete-btn">Delete</button>
              <form
                action="/categories/<%= category.id %>/delete"
                method="post"
                style="display: none"
                class="delete-form"
              >
                <input
                  type="text"
                  name="adminKey"
                  id="adminKey"
                  placeholder="Enter Admin Key"
                  required
                />
                <button type="submit">Confirm</button>
                <button type="button" class="cancel-deletion">Cancel</button>
              </form>
            </li>
            <% }) %>
          </ul>
        </div>
      </section>

      <button id="addCategory">Add Category</button>

      <dialog id="addCategoryDialog">
        <h2>Add New Category</h2>
        <%- include('partials/errors.ejs') %>
        <form method="POST" action="/categories">
          <label for="categoryName">Category Name:</label>
          <input type="text" id="categoryName" name="category" required />
          <label for="sellerName">Seller Name:</label>
          <select name="seller" id="sellerName">
            <option value="FreshMart">FreshMart</option>
            <option value="Organic Heaven">Organic Heaven</option>
          </select>

          <div>
            <button type="submit">Add</button>
            <button type="button" id="cancelCategory">Cancel</button>
          </div>
        </form>
      </dialog>
      <a href="/" class="back-link">&#x25c0; Go Back</a>
    </main>
    <%- include('partials/footer') %>
  </body>
</html>
